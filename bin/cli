#!/usr/bin/env node

var argv = require("optimist").
usage("Usage: $0 -t [type] -c [config] -s [maestro script]").
demand(["t"]).
default("c", "~/.maestro/config.json").
describe("s", "script to run with maestro").
describe("t", "type of server").
describe("c", "config path").
argv;

var outcome = require("outcome"),
maestro = require("../"),
loader;


function getConfig(options) {
	if(!options) options = process.env.ProgramData ? [process.env.ProgramData, "\\maestro\\config"].join("") : "~/.maestro/config";
	return typeof options == "object" ? options : require(options.replace("~", process.env.HOME));
}

var c = getConfig(argv.c);
c.type = argv.t;

if(argv.t == "server") {
	loader = maestro.server(c);
} else {
	loader = maestro.client(c);
}

if(argv.s) loader.require(argv.s);


loader.load();
